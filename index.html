<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF Tools Pro - DIPTO RAY</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#f7f7fb;color:#111;position:relative;overflow-x:hidden;min-height:100vh;padding-top:60px}
    
    /* Header */
    .header{position:fixed;top:0;left:0;right:0;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,0.1);z-index:1000;padding:12px 20px}
    .header-content{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
    .logo{font-size:16px;font-weight:bold;color:#2b6cb0;cursor:pointer;max-width:600px}
    .user-info{display:flex;gap:15px;align-items:center}
    .user-name{color:#2b6cb0;font-weight:500;cursor:pointer;position:relative}
    .logout-btn{background:#dc2626;color:#fff;border:0;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px}
    .login-btn{background:#2b6cb0;color:#fff;border:0;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px}
    .profile-btn{background:#059669;color:#fff;border:0;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:14px}
    
    /* Profile Modal */
    .profile-modal{display:none;position:absolute;top:50px;right:0;background:#fff;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.15);padding:20px;min-width:250px;z-index:3000}
    .profile-modal.active{display:block}
    .profile-info{margin-bottom:15px}
    .profile-info p{margin:8px 0;color:#666;font-size:14px}
    .profile-info strong{color:#2b6cb0}
    
    /* Auth Modal */
    .modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:2000;align-items:center;justify-content:center}
    .modal.active{display:flex}
    .modal-content{background:#fff;padding:30px;border-radius:12px;max-width:400px;width:90%}
    .modal-content h2{margin-bottom:20px;color:#2b6cb0}
    .form-group{margin-bottom:15px}
    .form-group label{display:block;margin-bottom:5px;font-weight:500}
    .form-group input{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px}
    .form-buttons{display:flex;gap:10px;margin-top:20px}
    .form-buttons button{flex:1;padding:10px;border:0;border-radius:6px;cursor:pointer;font-size:14px}
    .btn-primary{background:#2b6cb0;color:#fff}
    .btn-secondary{background:#6b7280;color:#fff}
    .switch-form{text-align:center;margin-top:15px;color:#666;font-size:14px}
    .switch-form a{color:#2b6cb0;cursor:pointer;text-decoration:underline}
    
    /* Premium Badge */
    .premium-badge{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:bold;display:inline-block;margin-left:8px}
    .premium-lock{background:rgba(255,215,0,0.2);border:2px solid #ffd700;padding:20px;border-radius:12px;text-align:center;margin:20px 0}
    .premium-lock h3{color:#b8860b;margin-bottom:10px}
    .premium-lock p{margin:10px 0;color:#666}
    .premium-contact{background:#e8f4fd;padding:12px;border-radius:8px;margin-top:15px;font-size:14px;color:#2b6cb0}
    .upgrade-btn{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;border:0;padding:12px 24px;border-radius:8px;cursor:pointer;font-weight:bold;font-size:16px}
    
    /* Main Content */
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .card{background:#fff;border-radius:12px;padding:30px;box-shadow:0 6px 18px rgba(18,18,18,0.06);margin-bottom:20px}
    h1{margin:0 0 10px;font-size:22px;color:#2b6cb0;text-align:center}
    h2{margin:20px 0 10px;font-size:18px;color:#2b6cb0}
    p{margin:6px 0;color:#444}
    .muted{color:#666;font-size:13px;text-align:center}
    
    /* Center Content */
    .center-content{display:flex;flex-direction:column;align-items:center;gap:15px;margin:20px 0}
    
    input[type=file]{display:none}
    .file-upload-btn{background:#2b6cb0;color:#fff;border:0;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:16px;display:inline-block}
    .file-upload-btn:hover{background:#1e4d7a}
    
    input[type=password],input[type=text],input[type=number]{display:block;margin:10px auto;padding:10px;border:1px solid #ddd;border-radius:6px;width:100%;max-width:400px}
    select{padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px}
    
    #preview{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:20px 0}
    .thumb{width:120px;height:120px;overflow:hidden;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#eef;padding:6px;border:1px solid #e0e0e0;cursor:move;position:relative;transition:transform 0.2s,box-shadow 0.2s}
    .thumb:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(43,108,176,0.3)}
    .thumb.dragging{opacity:0.5;transform:scale(0.95)}
    .thumb.drag-over{border:2px dashed #2b6cb0;background:#e8f4fd}
    .thumb img{max-width:100%;max-height:100%;pointer-events:none}
    .thumb .delete-btn{position:absolute;top:2px;right:2px;background:rgba(220,38,38,0.9);color:#fff;border:0;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:16px;line-height:1;display:flex;align-items:center;justify-content:center}
    .thumb .delete-btn:hover{background:#dc2626}
    
    button{background:#2b6cb0;color:#fff;border:0;padding:12px 24px;border-radius:8px;cursor:pointer;margin:4px;font-size:15px;transition:background 0.3s}
    button:hover{background:#1e4d7a}
    button:disabled{background:#999;cursor:not-allowed}
    button.danger{background:#dc2626}
    button.danger:hover{background:#b91c1c}
    button.success{background:#059669}
    button.success:hover{background:#047857}
    
    /* Compression Quality Buttons */
    .quality-buttons{display:flex;gap:10px;justify-content:center;margin:15px 0}
    .quality-btn{background:#e5e7eb;color:#111;border:2px solid #e5e7eb;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:14px;transition:all 0.3s}
    .quality-btn:hover{background:#d1d5db}
    .quality-btn.active{background:#2b6cb0;color:#fff;border-color:#2b6cb0}
    
    .row{display:flex;gap:15px;align-items:center;margin:15px 0;flex-wrap:wrap;justify-content:center}
    label{font-size:14px;font-weight:500}
    hr{border:0;border-top:1px solid #e0e0e0;margin:30px 0}
    
    .info-box{background:#e8f4fd;padding:15px;border-radius:8px;margin:15px 0}
    .success-box{background:#d1fae5;padding:15px;border-radius:8px;margin:15px 0;border:1px solid #10b981}
    .warning-box{background:#fef3c7;padding:15px;border-radius:8px;margin:15px 0;border:1px solid #f59e0b}
    .error-box{background:#fee2e2;padding:15px;border-radius:8px;margin:15px 0;border:1px solid #dc2626}
    
    .progress{background:#e0e0e0;height:10px;border-radius:5px;overflow:hidden;margin:15px 0}
    .progress-bar{background:#2b6cb0;height:100%;width:0;transition:width 0.3s}
    
    .floating-text{position:fixed;font-weight:bold;font-size:18px;color:#2b6cb0;text-shadow:2px 2px 4px rgba(0,0,0,0.2);pointer-events:none;z-index:999;white-space:nowrap;opacity:0.6}
    
    /* History Section */
    .history-list{margin-top:15px}
    .history-item{background:#f9fafb;border:1px solid #e5e7eb;padding:12px;border-radius:8px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
    .history-info{flex:1}
    .history-info h3{font-size:14px;color:#2b6cb0;margin-bottom:4px}
    .history-info p{font-size:12px;color:#666;margin:2px 0}
    .history-actions{display:flex;gap:8px}
    .history-actions button{margin:0;padding:6px 12px;font-size:12px}
    
    /* Compare Preview */
    .compare-container{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:15px}
    .compare-preview{border:2px solid #e5e7eb;border-radius:8px;padding:10px;background:#f9fafb}
    .compare-preview h3{font-size:14px;color:#2b6cb0;margin-bottom:8px}
    .compare-preview canvas{width:100%;border:1px solid #ddd;border-radius:4px}
    .diff-highlight{background:#fef3c7;padding:8px;border-radius:6px;margin-top:10px;font-size:13px}
    
    /* Tool Grid - 4 per row */
    .tool-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-top:20px}
    @media (max-width:1024px){.tool-grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:768px){.tool-grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:480px){.tool-grid{grid-template-columns:1fr}}
    
    .tool-card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 6px 18px rgba(18,18,18,0.06);cursor:pointer;transition:transform 0.3s,box-shadow 0.3s;border:2px solid transparent}
    .tool-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(43,108,176,0.3);border-color:#2b6cb0}
    .tool-card.premium{border-color:#ffd700;position:relative}
    .tool-card.premium::before{content:'PREMIUM';position:absolute;top:10px;right:10px;background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;padding:4px 10px;border-radius:20px;font-size:10px;font-weight:bold}
    .tool-icon{font-size:48px;margin-bottom:15px;text-align:center}
    .tool-title{font-size:18px;font-weight:bold;color:#2b6cb0;margin-bottom:8px;text-align:center}
    .tool-desc{font-size:13px;color:#666;text-align:center}
    
    /* Page System */
    .page{display:none}
    .page.active{display:block}
    
    .back-btn{background:#059669;display:inline-flex;align-items:center;gap:5px;margin-bottom:20px}
    .back-btn:hover{background:#047857}
    
    /* Top Actions */
    .top-actions{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px}
    .top-actions .back-btn{margin:0}
    .top-actions .right-btns{display:flex;gap:10px}
    
    .file-info-text{display:block;margin:10px 0;color:#666;font-size:14px;text-align:center}
  </style>
</head>
<body>
  <!-- Floating Text Elements -->
  <div class="floating-text" id="float1">DIPTO RAY ‚Ä¢ 01305482427</div>
  <div class="floating-text" id="float2">DIPTO RAY ‚Ä¢ 01305482427</div>
  <div class="floating-text" id="float3">DIPTO RAY ‚Ä¢ 01305482427</div>

  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="logo" onclick="goToHome()">üìÑ ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶∏‡ßá‡¶¨‡¶æ ‡¶™‡ßá‡¶§‡ßá ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</div>
      <div class="user-info" id="userInfo">
        <button class="login-btn" onclick="showAuthModal('login')">Login / Register</button>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div class="profile-modal" id="profileModal">
    <div class="profile-info">
      <p><strong>Username:</strong> <span id="profileUsername"></span></p>
      <p><strong>Email:</strong> <span id="profileEmail"></span></p>
      <p><strong>Status:</strong> <span id="profileStatus"></span></p>
      <p><strong>Registered:</strong> <span id="profileCreated"></span></p>
    </div>
    <button class="logout-btn" onclick="logout()" style="width:100%">Logout</button>
  </div>

  <!-- Auth Modal -->
  <div class="modal" id="authModal">
    <div class="modal-content">
      <h2 id="authTitle">Login</h2>
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="authUsername" placeholder="Enter username" />
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="authPassword" placeholder="Enter password" />
      </div>
      <div class="form-group" id="emailGroup" style="display:none">
        <label>Email (Optional)</label>
        <input type="text" id="authEmail" placeholder="Enter email" />
      </div>
      <div class="form-buttons">
        <button class="btn-primary" id="authSubmitBtn">Login</button>
        <button class="btn-secondary" onclick="closeAuthModal()">Cancel</button>
      </div>
      <div class="switch-form">
        <span id="switchText">Don't have an account? <a onclick="switchAuthMode()">Register</a></span>
      </div>
    </div>
  </div>

  <div class="container">
    
    <!-- Home Page -->
    <div class="page active" id="homePage">
      <div class="card">
        <h1>üõ†Ô∏è ‡¶∏‡¶ï‡¶≤ PDF ‡¶ü‡ßÅ‡¶≤‡¶∏</h1>
        <p class="muted">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶ü‡ßÅ‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        
        <div class="tool-grid">
          <div class="tool-card" onclick="goToPage('jpgToPdf')">
            <div class="tool-icon">üì∏</div>
            <div class="tool-title">JPG to PDF</div>
            <div class="tool-desc">‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶õ‡¶¨‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø PDF ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</div>
          </div>
          
          <div class="tool-card" onclick="goToPage('pdfCompress')">
            <div class="tool-icon">üóúÔ∏è</div>
            <div class="tool-title">PDF Compress</div>
            <div class="tool-desc">PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ï‡¶Æ‡¶™‡ßç‡¶∞‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®</div>
          </div>
          
          <div class="tool-card" onclick="goToPage('pdfToJpg')">
            <div class="tool-icon">üñºÔ∏è</div>
            <div class="tool-title">PDF to JPG</div>
            <div class="tool-desc">PDF ‡¶è‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶™‡ßá‡¶ú JPG ‡¶è ‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</div>
          </div>
          
          <div class="tool-card" onclick="goToPage('history')">
            <div class="tool-icon">üìú</div>
            <div class="tool-title">History</div>
            <div class="tool-desc">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</div>
          </div>
          
          <div class="tool-card premium" onclick="goToPage('pdfUnlock')">
            <div class="tool-icon">üîì</div>
            <div class="tool-title">PDF Unlock</div>
            <div class="tool-desc">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶ü‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶° PDF ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</div>
          </div>
          
          <div class="tool-card premium" onclick="goToPage('pdfCompare')">
            <div class="tool-icon">üîç</div>
            <div class="tool-title">PDF Compare</div>
            <div class="tool-desc">‡¶¶‡ßÅ‡¶ü‡¶ø PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</div>
          </div>
        </div>
      </div>
    </div>

    <!-- JPG to PDF Page -->
    <div class="page" id="jpgToPdfPage">
      <button class="back-btn" onclick="goToHome()">‚Üê ‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
      
      <div class="card">
        <h1>üì∏ JPG ‚Üí PDF Converter</h1>
        <p class="muted">‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶æ‡¶á PDF ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶∏‡¶¨‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶Ø‡¶º‡•§</p>

        <div class="center-content">
          <input id="files" type="file" accept="image/*" multiple />
          <label for="files" class="file-upload-btn">üìÅ ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
          <span class="file-info-text" id="fileCount">‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á</span>
        </div>

        <div id="preview"></div>

        <p class="muted" style="margin-top:10px">‡¶õ‡¶¨‡¶ø‡¶ó‡ßÅ‡¶≤‡ßã ‡¶°‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ó ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶ú‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§ ‡¶ï‡ßç‡¶∞‡¶∏ (√ó) ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</p>

        <div class="row">
          <label for="paper">Paper size:</label>
          <select id="paper">
            <option value="a4">A4 (portrait)</option>
            <option value="a4-land">A4 (landscape)</option>
            <option value="letter">Letter (portrait)</option>
            <option value="auto">Auto</option>
          </select>
          <label style="margin-left:10px">Quality:</label>
          <select id="quality">
            <option value="1">High</option>
            <option value="0.8">Medium</option>
            <option value="0.6">Low</option>
          </select>
        </div>

        <div class="center-content">
          <button id="convert">üîÑ Convert to PDF</button>
        </div>

        <p id="status" class="muted"></p>
      </div>
    </div>

    <!-- PDF Compress Page -->
    <div class="page" id="pdfCompressPage">
      <button class="back-btn" onclick="goToHome()">‚Üê ‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
      
      <div class="card">
        <h1>üóúÔ∏è PDF Compressor</h1>
        <p class="muted">PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ï‡¶Æ‡¶™‡ßç‡¶∞‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶∏‡¶¨‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶Ø‡¶º‡•§</p>

        <div class="center-content">
          <input id="pdfFile" type="file" accept=".pdf,application/pdf" />
          <label for="pdfFile" class="file-upload-btn">üìÅ PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
          <span class="file-info-text" id="pdfFileName">‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á</span>
        </div>

        <div class="center-content">
          <p style="margin:10px 0;font-weight:bold;color:#2b6cb0">‡¶ï‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:</p>
          <div class="quality-buttons">
            <button class="quality-btn active" data-level="high" onclick="selectCompressionLevel('high')">
              ‚≠ê High Quality
            </button>
            <button class="quality-btn" data-level="standard" onclick="selectCompressionLevel('standard')">
              ‚ú® Standard
            </button>
            <button class="quality-btn" data-level="low" onclick="selectCompressionLevel('low')">
              üíæ Low (Max Compression)
            </button>
          </div>
          <button id="compressBtn">üóúÔ∏è Compress PDF</button>
        </div>

        <div class="info-box" id="fileInfo" style="display:none">
          <p><strong>‡¶´‡¶æ‡¶á‡¶≤:</strong> <span id="fileName"></span></p>
          <p><strong>‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡¶æ‡¶á‡¶ú:</strong> <span id="originalSize"></span></p>
          <p><strong>‡¶ï‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡ßá‡¶∏‡¶° ‡¶∏‡¶æ‡¶á‡¶ú:</strong> <span id="compressedSize"></span></p>
        </div>

        <div class="progress" id="progressBar" style="display:none">
          <div class="progress-bar" id="progressFill"></div>
        </div>

        <p id="compressStatus" class="muted"></p>
      </div>
    </div>

    <!-- PDF to JPG Page -->
    <div class="page" id="pdfToJpgPage">
      <button class="back-btn" onclick="goToHome()">‚Üê ‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
      
      <div class="card">
        <h1>üñºÔ∏è PDF to JPG Converter</h1>
        <p class="muted">PDF ‡¶è‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶™‡ßá‡¶ú ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ JPG ‡¶õ‡¶¨‡¶ø‡¶§‡ßá ‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>

        <div class="center-content">
          <input id="pdfToJpgFile" type="file" accept=".pdf,application/pdf" />
          <label for="pdfToJpgFile" class="file-upload-btn">üìÅ PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
          <span class="file-info-text" id="jpgPdfFileName">‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á</span>
        </div>

        <div class="row">
          <label for="jpgQuality">JPG Quality:</label>
          <select id="jpgQuality">
            <option value="1">High (100%)</option>
            <option value="0.9" selected>Very Good (90%)</option>
            <option value="0.8">Good (80%)</option>
            <option value="0.7">Medium (70%)</option>
          </select>
          <label style="margin-left:10px">Scale:</label>
          <select id="jpgScale">
            <option value="2">200%</option>
            <option value="1.5" selected>150%</option>
            <option value="1">100%</option>
            <option value="0.75">75%</option>
          </select>
        </div>

        <div class="center-content">
          <button id="convertToJpgBtn">üîÑ Convert to JPG</button>
        </div>

        <div class="progress" id="jpgProgressBar" style="display:none">
          <div class="progress-bar" id="jpgProgressFill"></div>
        </div>

        <p id="jpgStatus" class="muted"></p>
        <div id="jpgPreview" style="display:flex;flex-wrap:wrap;gap:10px;margin-top:15px;justify-content:center"></div>
      </div>
    </div>

    <!-- PDF Unlock Page (Premium) -->
    <div class="page" id="pdfUnlockPage">
      <button class="back-btn" onclick="goToHome()">‚Üê ‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
      
      <div class="card">
        <h1>üîì PDF Unlock (Remove Password) <span class="premium-badge">PREMIUM</span></h1>
        <p class="muted">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶ü‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶° PDF ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>

        <div id="unlockPremiumBlock" class="premium-lock">
          <h3>üîí ‡¶è‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞</h3>
          <p>‡¶è‡¶á ‡¶ü‡ßÅ‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡¶∂‡¶ø‡¶™ ‡¶®‡¶ø‡¶®</p>
          <div class="premium-contact">
            üìû ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶®‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá <strong>01305-482427</strong> ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
          </div>
          <button class="upgrade-btn" onclick="upgradeToPremium()">‚ú® Upgrade to Premium (Demo)</button>
        </div>

        <div id="unlockContent" style="display:none">
          <div class="center-content">
            <input id="unlockPdfFile" type="file" accept=".pdf,application/pdf" />
            <label for="unlockPdfFile" class="file-upload-btn">üìÅ PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
            <span class="file-info-text" id="unlockPdfFileName">‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á</span>
            <input id="pdfPassword" type="password" placeholder="PDF ‡¶è‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá)" />
          </div>

          <div class="center-content">
            <button id="unlockBtn">üîì Unlock PDF</button>
            <button id="checkBtn" class="success">‚úÖ Check PDF Status</button>
          </div>

          <div class="info-box" id="unlockInfo" style="display:none">
            <p><strong>‡¶´‡¶æ‡¶á‡¶≤:</strong> <span id="unlockFileName"></span></p>
            <p><strong>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</strong> <span id="unlockStatus"></span></p>
          </div>

          <p id="unlockMessage" class="muted"></p>
        </div>
      </div>
    </div>

    <!-- PDF Compare Page (Premium) -->
    <div class="page" id="pdfComparePage">
      <button class="back-btn" onclick="goToHome()">‚Üê ‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
      
      <div class="card">
        <h1>üîç PDF Compare (‡¶§‡ßÅ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®) <span class="premium-badge">PREMIUM</span></h1>
        <p class="muted">‡¶¶‡ßÅ‡¶ü‡¶ø PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∞‡ßç‡¶•‡¶ï‡ßç‡¶Ø ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p>

        <div id="comparePremiumBlock" class="premium-lock">
          <h3>üîí ‡¶è‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞</h3>
          <p>‡¶è‡¶á ‡¶ü‡ßÅ‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡¶∂‡¶ø‡¶™ ‡¶®‡¶ø‡¶®</p>
          <div class="premium-contact">
            üìû ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶®‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá <strong>01305-482427</strong> ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
          </div>
          <button class="upgrade-btn" onclick="upgradeToPremium()">‚ú® Upgrade to Premium (Demo)</button>
        </div>

        <div id="compareContent" style="display:none">
          <div class="center-content">
            <label style="font-weight:bold">‡¶™‡ßç‡¶∞‡¶•‡¶Æ PDF:</label>
            <input id="comparePdf1" type="file" accept=".pdf,application/pdf" />
            <label for="comparePdf1" class="file-upload-btn">üìÅ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ PDF ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
            <span class="file-info-text" id="compare1FileName">‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á</span>
          </div>

          <div class="center-content">
            <label style="font-weight:bold">‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º PDF:</label>
            <input id="comparePdf2" type="file" accept=".pdf,application/pdf" />
            <label for="comparePdf2" class="file-upload-btn">üìÅ ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º PDF ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
            <span class="file-info-text" id="compare2FileName">‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á</span>
          </div>

          <div class="row">
            <label for="comparePage">‡¶™‡ßá‡¶ú ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label>
            <input type="number" id="comparePage" value="1" min="1" style="max-width:100px" />
          </div>

          <div class="center-content">
            <button id="compareBtn">üîç Compare PDFs</button>
          </div>

          <div class="progress" id="compareProgressBar" style="display:none">
            <div class="progress-bar" id="compareProgressFill"></div>
          </div>

          <p id="compareStatus" class="muted"></p>

          <div class="compare-container" id="compareContainer" style="display:none">
            <div class="compare-preview">
              <h3>üìÑ PDF 1</h3>
              <canvas id="canvas1"></canvas>
            </div>
            <div class="compare-preview">
              <h3>üìÑ PDF 2</h3>
              <canvas id="canvas2"></canvas>
            </div>
          </div>

          <div class="diff-highlight" id="diffResult" style="display:none"></div>
        </div>
      </div>
    </div>

    <!-- History Page -->
    <div class="page" id="historyPage">
      <button class="back-btn" onclick="goToHome()">‚Üê ‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
      
      <div class="card">
        <h1>üìú ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h1>
        <p class="muted">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ PDF ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p>
        
        <div class="history-list" id="historyList">
          <p class="muted">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    const { jsPDF } = window.jspdf;
    const { PDFDocument } = PDFLib;

    // ============== Global State ==============
    let currentUser = null;
    let authMode = 'login';
    let selectedCompressionLevel = 'high'; // Default compression level

    // ============== Page Navigation ==============
    function goToHome() {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById('homePage').classList.add('active');
    }

    function goToPage(pageId) {
      const pageMap = {
        'jpgToPdf': 'jpgToPdfPage',
        'pdfCompress': 'pdfCompressPage',
        'pdfToJpg': 'pdfToJpgPage',
        'pdfUnlock': 'pdfUnlockPage',
        'pdfCompare': 'pdfComparePage',
        'history': 'historyPage'
      };

      const targetPage = pageMap[pageId];
      if (targetPage) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(targetPage).classList.add('active');

        if (pageId === 'pdfUnlock' || pageId === 'pdfCompare') {
          checkPremiumAccess(pageId);
        }

        if (pageId === 'history') {
          loadHistory();
        }
      }
    }

    // ============== Compression Level Selection ==============
    function selectCompressionLevel(level) {
      selectedCompressionLevel = level;
      document.querySelectorAll('.quality-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-level="${level}"]`).classList.add('active');
    }

    // ============== User Authentication System ==============
    function initAuth() {
      const saved = localStorage.getItem('pdftools_user');
      if (saved) {
        try {
          currentUser = JSON.parse(saved);
          updateUserUI();
        } catch (e) {
          console.error('Failed to load user:', e);
          localStorage.removeItem('pdftools_user');
        }
      }
    }

    function updateUserUI() {
      const userInfo = document.getElementById('userInfo');
      if (currentUser) {
        const premiumBadge = currentUser.isPremium ? '<span class="premium-badge">PREMIUM</span>' : '';
        userInfo.innerHTML = `
          <span class="user-name" onclick="toggleProfile()">üë§ ${currentUser.username} ${premiumBadge}</span>
          <button class="logout-btn" onclick="logout()">Logout</button>
        `;
        
        // Update profile info
        document.getElementById('profileUsername').textContent = currentUser.username;
        document.getElementById('profileEmail').textContent = currentUser.email || 'N/A';
        document.getElementById('profileStatus').textContent = currentUser.isPremium ? '‚ú® Premium Member' : 'üÜì Free User';
        
        const users = JSON.parse(localStorage.getItem('pdftools_users') || '[]');
        const fullUser = users.find(u => u.username === currentUser.username);
        if (fullUser && fullUser.created) {
          document.getElementById('profileCreated').textContent = new Date(fullUser.created).toLocaleDateString('bn-BD');
        }
      } else {
        userInfo.innerHTML = '<button class="login-btn" onclick="showAuthModal(\'login\')">Login / Register</button>';
      }
    }

    function toggleProfile() {
      const modal = document.getElementById('profileModal');
      modal.classList.toggle('active');
    }

    // Close profile modal when clicking outside
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('profileModal');
      const userName = document.querySelector('.user-name');
      if (modal.classList.contains('active') && !modal.contains(e.target) && !userName.contains(e.target)) {
        modal.classList.remove('active');
      }
    });

    function showAuthModal(mode) {
      authMode = mode;
      const modal = document.getElementById('authModal');
      const title = document.getElementById('authTitle');
      const submitBtn = document.getElementById('authSubmitBtn');
      const emailGroup = document.getElementById('emailGroup');
      const switchText = document.getElementById('switchText');

      if (mode === 'login') {
        title.textContent = 'Login';
        submitBtn.textContent = 'Login';
        emailGroup.style.display = 'none';
        switchText.innerHTML = 'Don\'t have an account? <a onclick="switchAuthMode()">Register</a>';
      } else {
        title.textContent = 'Register';
        submitBtn.textContent = 'Register';
        emailGroup.style.display = 'block';
        switchText.innerHTML = 'Already have an account? <a onclick="switchAuthMode()">Login</a>';
      }

      modal.classList.add('active');
      
      document.getElementById('authUsername').value = '';
      document.getElementById('authPassword').value = '';
      document.getElementById('authEmail').value = '';
    }

    function switchAuthMode() {
      showAuthMode(authMode === 'login' ? 'register' : 'login');
    }

    function closeAuthModal() {
      document.getElementById('authModal').classList.remove('active');
    }

    document.getElementById('authSubmitBtn').addEventListener('click', () => {
      if (authMode === 'login') {
        handleLogin();
      } else {
        handleRegister();
      }
    });

    function handleLogin() {
      const username = document.getElementById('authUsername').value.trim();
      const password = document.getElementById('authPassword').value.trim();

      if (!username || !password) {
        alert('Username ‡¶è‡¶¨‡¶Ç Password ‡¶¶‡¶ø‡¶®');
        return;
      }

      const users = JSON.parse(localStorage.getItem('pdftools_users') || '[]');
      const user = users.find(u => u.username === username && u.password === password);

      if (user) {
        currentUser = { 
          username: user.username, 
          email: user.email,
          isPremium: user.isPremium || false
        };
        localStorage.setItem('pdftools_user', JSON.stringify(currentUser));
        closeAuthModal();
        updateUserUI();
        loadHistory();
        alert('‚úÖ ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!');
      } else {
        alert('‚ùå ‡¶≠‡ßÅ‡¶≤ Username ‡¶¨‡¶æ Password');
      }
    }

    function handleRegister() {
      const username = document.getElementById('authUsername').value.trim();
      const password = document.getElementById('authPassword').value.trim();
      const email = document.getElementById('authEmail').value.trim();

      if (!username || !password) {
        alert('Username ‡¶è‡¶¨‡¶Ç Password ‡¶¶‡¶ø‡¶®');
        return;
      }

      if (username.length < 3) {
        alert('Username ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß© ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá');
        return;
      }

      if (password.length < 4) {
        alert('Password ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß™ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá');
        return;
      }

      const users = JSON.parse(localStorage.getItem('pdftools_users') || '[]');
      
      if (users.find(u => u.username === username)) {
        alert('‚ùå ‡¶è‡¶á Username ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ü‡¶õ‡ßá');
        return;
      }

      const newUser = { 
        username, 
        password, 
        email, 
        isPremium: false,
        created: new Date().toISOString() 
      };
      
      users.push(newUser);
      localStorage.setItem('pdftools_users', JSON.stringify(users));

      // Auto-login after registration
      currentUser = { username, email, isPremium: false };
      localStorage.setItem('pdftools_user', JSON.stringify(currentUser));
      closeAuthModal();
      updateUserUI();
      alert('‚úÖ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá‡¶®‡•§');
    }

    function logout() {
      if (confirm('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
        currentUser = null;
        localStorage.removeItem('pdftools_user');
        updateUserUI();
        document.getElementById('profileModal').classList.remove('active');
        goToHome();
        alert('‚úÖ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶∏‡¶´‡¶≤');
      }
    }

    // ============== Premium System ==============
    function checkPremiumAccess(pageId) {
      const isPremium = currentUser && currentUser.isPremium;
      
      if (pageId === 'pdfUnlock') {
        document.getElementById('unlockPremiumBlock').style.display = isPremium ? 'none' : 'block';
        document.getElementById('unlockContent').style.display = isPremium ? 'block' : 'none';
      } else if (pageId === 'pdfCompare') {
        document.getElementById('comparePremiumBlock').style.display = isPremium ? 'none' : 'block';
        document.getElementById('compareContent').style.display = isPremium ? 'block' : 'none';
      }
    }

    function upgradeToPremium() {
      if (!currentUser) {
        alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
        showAuthModal('login');
        return;
      }

      if (confirm('Premium ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡¶∂‡¶ø‡¶™ ‡¶®‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶®?\n\nüìû ‡¶Ü‡¶∏‡¶≤ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø 01305-482427 ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§\n\n(‡¶°‡ßá‡¶Æ‡ßã: ‡¶è‡¶ñ‡¶® ‡¶´‡ßç‡¶∞‡¶ø ‡¶Ü‡¶™‡¶ó‡ßç‡¶∞‡ßá‡¶° ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?)')) {
        const users = JSON.parse(localStorage.getItem('pdftools_users') || '[]');
        const userIndex = users.findIndex(u => u.username === currentUser.username);
        
        if (userIndex !== -1) {
          users[userIndex].isPremium = true;
          localStorage.setItem('pdftools_users', JSON.stringify(users));
        }

        currentUser.isPremium = true;
        localStorage.setItem('pdftools_user', JSON.stringify(currentUser));
        
        updateUserUI();
        alert('üéâ ‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® Premium ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞! (‡¶°‡ßá‡¶Æ‡ßã ‡¶Æ‡ßã‡¶°)');
        
        const currentPageId = document.querySelector('.page.active').id;
        if (currentPageId === 'pdfUnlockPage') {
          checkPremiumAccess('pdfUnlock');
        } else if (currentPageId === 'pdfComparePage') {
          checkPremiumAccess('pdfCompare');
        }
      }
    }

    // ============== History System ==============
    function saveToHistory(type, fileName, data) {
      if (!currentUser) return;

      const historyKey = `pdftools_history_${currentUser.username}`;
      const history = JSON.parse(localStorage.getItem(historyKey) || '[]');
      
      const entry = {
        id: Date.now(),
        type: type,
        fileName: fileName,
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleDateString('bn-BD'),
        time: new Date().toLocaleTimeString('bn-BD'),
        data: data
      };

      history.unshift(entry);
      
      if (history.length > 50) {
        history.splice(50);
      }

      try {
        localStorage.setItem(historyKey, JSON.stringify(history));
      } catch (e) {
        console.error('Failed to save history:', e);
        history.splice(20);
        localStorage.setItem(historyKey, JSON.stringify(history));
      }
    }

    function loadHistory() {
      if (!currentUser) {
        document.getElementById('historyList').innerHTML = '<p class="muted">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p>';
        return;
      }

      const historyKey = `pdftools_history_${currentUser.username}`;
      const history = JSON.parse(localStorage.getItem(historyKey) || '[]');
      const historyList = document.getElementById('historyList');

      if (history.length === 0) {
        historyList.innerHTML = '<p class="muted">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶®‡ßá‡¶á‡•§ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá‡•§</p>';
        return;
      }

      historyList.innerHTML = history.map(item => `
        <div class="history-item">
          <div class="history-info">
            <h3>${getTypeIcon(item.type)} ${item.type}</h3>
            <p><strong>‡¶´‡¶æ‡¶á‡¶≤:</strong> ${item.fileName}</p>
            <p><strong>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${item.date} | ${item.time}</p>
          </div>
          <div class="history-actions">
            <button onclick="redownloadFromHistory(${item.id})" class="success">üì• ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
            <button onclick="deleteHistoryItem(${item.id})" class="danger">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
          </div>
        </div>
      `).join('');
    }

    function getTypeIcon(type) {
      const icons = {
        'JPG to PDF': 'üì∏',
        'PDF Compress': 'üóúÔ∏è',
        'PDF to JPG': 'üñºÔ∏è',
        'PDF Unlock': 'üîì',
        'PDF Compare': 'üîç'
      };
      return icons[type] || 'üìÑ';
    }

    function redownloadFromHistory(id) {
      if (!currentUser) return;

      const historyKey = `pdftools_history_${currentUser.username}`;
      const history = JSON.parse(localStorage.getItem(historyKey) || '[]');
      const item = history.find(h => h.id === id);

      if (!item || !item.data) {
        alert('‚ùå ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø');
        return;
      }

      try {
        const blob = base64ToBlob(item.data.base64, item.data.mimeType);
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = item.data.downloadName || item.fileName;
        a.click();
        URL.revokeObjectURL(url);
        alert('‚úÖ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
      } catch (err) {
        console.error('Download error:', err);
        alert('‚ùå ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
      }
    }

    function deleteHistoryItem(id) {
      if (!currentUser) return;

      if (!confirm('‡¶è‡¶á ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;

      const historyKey = `pdftools_history_${currentUser.username}`;
      let history = JSON.parse(localStorage.getItem(historyKey) || '[]');
      history = history.filter(h => h.id !== id);
      localStorage.setItem(historyKey, JSON.stringify(history));
      loadHistory();
    }

    function blobToBase64(blob) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    }

    function base64ToBlob(base64, mimeType) {
      const byteCharacters = atob(base64);
      const byteNumbers = new Array(byteCharacters.length);
      for (let i = 0; i < byteCharacters.length; i++) {
        byteNumbers[i] = byteCharacters.charCodeAt(i);
      }
      const byteArray = new Uint8Array(byteNumbers);
      return new Blob([byteArray], { type: mimeType });
    }

    // ============== File Selection Display ==============
    document.getElementById('files').addEventListener('change', function(e) {
      const count = e.target.files.length;
      document.getElementById('fileCount').textContent = count > 0 ? `${count} ‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§` : '‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á';
    });

    document.getElementById('pdfFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      document.getElementById('pdfFileName').textContent = file ? file.name : '‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á';
    });

    document.getElementById('pdfToJpgFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      document.getElementById('jpgPdfFileName').textContent = file ? file.name : '‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á';
    });

    document.getElementById('unlockPdfFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      document.getElementById('unlockPdfFileName').textContent = file ? file.name : '‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á';
    });

    document.getElementById('comparePdf1').addEventListener('change', function(e) {
      const file = e.target.files[0];
      document.getElementById('compare1FileName').textContent = file ? file.name : '‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á';
    });

    document.getElementById('comparePdf2').addEventListener('change', function(e) {
      const file = e.target.files[0];
      document.getElementById('compare2FileName').textContent = file ? file.name : '‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á';
    });

    // ============== Floating Text Animation ==============
    function initFloatingText() {
      const floaters = [
        { el: document.getElementById('float1'), x: 100, y: 100, dx: 1.5, dy: 1.2 },
        { el: document.getElementById('float2'), x: 300, y: 200, dx: -1.3, dy: 1.5 },
        { el: document.getElementById('float3'), x: 500, y: 300, dx: 1.4, dy: -1.3 }
      ];

      function animate() {
        floaters.forEach(f => {
          f.x += f.dx;
          f.y += f.dy;

          const rect = f.el.getBoundingClientRect();
          const w = rect.width;
          const h = rect.height;

          if (f.x <= 0 || f.x + w >= window.innerWidth) f.dx = -f.dx;
          if (f.y <= 60 || f.y + h >= window.innerHeight) f.dy = -f.dy;

          f.el.style.left = f.x + 'px';
          f.el.style.top = f.y + 'px';
        });

        requestAnimationFrame(animate);
      }

      animate();
    }

    // ============== JPG to PDF ==============
    const filesInput = document.getElementById('files');
    const preview = document.getElementById('preview');
    const convertBtn = document.getElementById('convert');
    const status = document.getElementById('status');
    const paperSel = document.getElementById('paper');
    const qualitySel = document.getElementById('quality');

    let files = [];
    let draggedElement = null;

    filesInput.addEventListener('change', (e)=>{
      const newFiles = Array.from(e.target.files).filter(f=>f.type.startsWith('image/'));
      files = [...files, ...newFiles];
      renderPreview();
    });

    function renderPreview(){
      preview.innerHTML = '';
      if(files.length===0){ 
        return;
      }
      
      files.forEach((file, idx)=>{
        const div = document.createElement('div'); 
        div.className='thumb';
        div.draggable = true;
        div.dataset.index = idx;
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.innerHTML = '√ó';
        deleteBtn.onclick = (e) => {
          e.stopPropagation();
          files.splice(idx, 1);
          renderPreview();
          document.getElementById('fileCount').textContent = files.length > 0 ? `${files.length} ‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§` : '‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á';
        };
        
        const img = document.createElement('img');
        const reader = new FileReader();
        reader.onload = function(ev){ img.src = ev.target.result; }
        reader.readAsDataURL(file);
        
        div.appendChild(img);
        div.appendChild(deleteBtn);
        
        div.addEventListener('dragstart', handleDragStart);
        div.addEventListener('dragend', handleDragEnd);
        div.addEventListener('dragover', handleDragOver);
        div.addEventListener('drop', handleDrop);
        div.addEventListener('dragenter', handleDragEnter);
        div.addEventListener('dragleave', handleDragLeave);
        
        preview.appendChild(div);
      });
    }

    function handleDragStart(e) {
      draggedElement = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragEnd(e) {
      this.classList.remove('dragging');
      document.querySelectorAll('.thumb').forEach(el => el.classList.remove('drag-over'));
    }

    function handleDragOver(e) {
      if (e.preventDefault) e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      return false;
    }

    function handleDragEnter(e) {
      if (this !== draggedElement) this.classList.add('drag-over');
    }

    function handleDragLeave(e) {
      this.classList.remove('drag-over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) e.stopPropagation();
      
      if (draggedElement !== this) {
        const draggedIdx = parseInt(draggedElement.dataset.index);
        const targetIdx = parseInt(this.dataset.index);
        
        const temp = files[draggedIdx];
        files[draggedIdx] = files[targetIdx];
        files[targetIdx] = temp;
        
        renderPreview();
      }
      
      return false;
    }

    function dataURLToImage(dataURL){
      return new Promise((res, rej)=>{
        const img = new Image();
        img.onload = ()=>res(img);
        img.onerror = rej;
        img.src = dataURL;
      });
    }

    convertBtn.addEventListener('click', async()=>{
      if(files.length===0){alert('‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');return}
      convertBtn.disabled = true;
      status.textContent = 'PDF ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';

      try{
        let pdf;
        const paper = paperSel.value;

        for(let i=0; i<files.length; i++){
          status.textContent = `‡¶õ‡¶¨‡¶ø ${i+1}/${files.length} ‡¶Ø‡ßã‡¶ó ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`;
          const reader = new FileReader();
          const dataURL = await new Promise((res, rej)=>{
            reader.onload = (ev)=>res(ev.target.result);
            reader.onerror = rej;
            reader.readAsDataURL(files[i]);
          });

          const img = await dataURLToImage(dataURL);
          const w = img.width, h = img.height;

          if(i===0){
            if(paper==='a4'){
              pdf = new jsPDF({orientation:'portrait',unit:'mm',format:'a4'});
            }else if(paper==='a4-land'){
              pdf = new jsPDF({orientation:'landscape',unit:'mm',format:'a4'});
            }else if(paper==='letter'){
              pdf = new jsPDF({orientation:'portrait',unit:'mm',format:'letter'});
            }else{
              const mmW = w*0.264583, mmH = h*0.264583;
              pdf = new jsPDF({orientation: w>h?'landscape':'portrait', unit:'mm', format:[mmW,mmH]});
            }
          }else{
            pdf.addPage();
          }

          const pageW = pdf.internal.pageSize.getWidth();
          const pageH = pdf.internal.pageSize.getHeight();
          const ratio = w/h;
          let finalW, finalH;
          if(ratio>pageW/pageH){
            finalW = pageW;
            finalH = pageW/ratio;
          }else{
            finalH = pageH;
            finalW = pageH*ratio;
          }
          const x = (pageW - finalW)/2;
          const y = (pageH - finalH)/2;

          pdf.addImage(dataURL, 'JPEG', x, y, finalW, finalH, undefined, 'FAST');
        }

        status.textContent = 'PDF ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
        const pdfBlob = pdf.output('blob');
        const fileName = 'converted.pdf';
        
        const base64 = await blobToBase64(pdfBlob);
        saveToHistory('JPG to PDF', fileName, {
          base64: base64,
          mimeType: 'application/pdf',
          downloadName: fileName
        });

        const url = URL.createObjectURL(pdfBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        a.click();
        URL.revokeObjectURL(url);

        status.textContent = '‚úÖ ‡¶∏‡¶´‡¶≤! PDF ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
      }catch(err){
        console.error(err);
        alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: '+(err.message||err));
        status.textContent = '‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá';
      }finally{
        convertBtn.disabled = false;
      }
    });

    // ============== PDF Compressor ==============
    const pdfFileInput = document.getElementById('pdfFile');
    const compressBtn = document.getElementById('compressBtn');
    const compressStatus = document.getElementById('compressStatus');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const originalSize = document.getElementById('originalSize');
    const compressedSize = document.getElementById('compressedSize');

    function formatBytes(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    compressBtn.addEventListener('click', async () => {
      const file = pdfFileInput.files[0];
      if (!file) {
        alert('‡¶è‡¶ï‡¶ü‡¶ø PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
        return;
      }

      compressBtn.disabled = true;
      compressStatus.textContent = 'PDF ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
      progressBar.style.display = 'block';
      progressFill.style.width = '0%';
      fileInfo.style.display = 'none';

      try {
        fileName.textContent = file.name;
        const originalSizeBytes = file.size;
        originalSize.textContent = formatBytes(originalSizeBytes);

        progressFill.style.width = '10%';

        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        const numPages = pdf.numPages;

        compressStatus.textContent = `${numPages} ‡¶ü‡¶ø ‡¶™‡ßá‡¶ú ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá...`;
        progressFill.style.width = '20%';

        // Set quality and scale based on selected compression level
        let quality, scale;
        if (selectedCompressionLevel === 'high') {
          quality = 0.85;
          scale = 1.5;
        } else if (selectedCompressionLevel === 'standard') {
          quality = 0.7;
          scale = 1.3;
        } else { // low
          quality = 0.5;
          scale = 1.0;
        }

        const newPdf = new jsPDF({ unit: 'pt', format: 'a4', compress: true });
        let isFirstPage = true;

        for (let pageNum = 1; pageNum <= numPages; pageNum++) {
          compressStatus.textContent = `‡¶™‡ßá‡¶ú ${pageNum}/${numPages} ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`;
          progressFill.style.width = (30 + (pageNum / numPages) * 60) + '%';

          const page = await pdf.getPage(pageNum);
          const viewport = page.getViewport({ scale: scale });

          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.width = viewport.width;
          canvas.height = viewport.height;

          await page.render({ canvasContext: context, viewport: viewport }).promise;

          const imgData = canvas.toDataURL('image/jpeg', quality);

          const pdfWidth = newPdf.internal.pageSize.getWidth();
          const pdfHeight = newPdf.internal.pageSize.getHeight();
          const imgRatio = viewport.width / viewport.height;
          const pdfRatio = pdfWidth / pdfHeight;

          let finalWidth, finalHeight;
          if (imgRatio > pdfRatio) {
            finalWidth = pdfWidth;
            finalHeight = pdfWidth / imgRatio;
          } else {
            finalHeight = pdfHeight;
            finalWidth = pdfHeight * imgRatio;
          }

          const xOffset = (pdfWidth - finalWidth) / 2;
          const yOffset = (pdfHeight - finalHeight) / 2;

          if (!isFirstPage) newPdf.addPage();
          isFirstPage = false;

          newPdf.addImage(imgData, 'JPEG', xOffset, yOffset, finalWidth, finalHeight, undefined, 'FAST');
        }

        compressStatus.textContent = 'PDF ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
        progressFill.style.width = '95%';

        const pdfBlob = newPdf.output('blob');
        const compressedSizeBytes = pdfBlob.size;
        
        compressedSize.textContent = formatBytes(compressedSizeBytes);
        fileInfo.style.display = 'block';

        const downloadName = file.name.replace('.pdf', '_compressed.pdf');
        
        const base64 = await blobToBase64(pdfBlob);
        saveToHistory('PDF Compress', file.name, {
          base64: base64,
          mimeType: 'application/pdf',
          downloadName: downloadName
        });

        const url = URL.createObjectURL(pdfBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = downloadName;
        a.click();
        URL.revokeObjectURL(url);

        progressFill.style.width = '100%';
        compressStatus.textContent = `‚úÖ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡¶ï‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡ßá‡¶∂‡¶®: ${Math.round((1 - compressedSizeBytes / originalSizeBytes) * 100)}%`;

      } catch (err) {
        console.error(err);
        alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + err.message);
        compressStatus.textContent = '‡¶ï‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•';
      } finally {
        compressBtn.disabled = false;
        setTimeout(() => {
          progressBar.style.display = 'none';
          progressFill.style.width = '0';
        }, 3000);
      }
    });

    // ============== PDF to JPG ==============
    const pdfToJpgFileInput = document.getElementById('pdfToJpgFile');
    const convertToJpgBtn = document.getElementById('convertToJpgBtn');
    const jpgStatus = document.getElementById('jpgStatus');
    const jpgProgressBar = document.getElementById('jpgProgressBar');
    const jpgProgressFill = document.getElementById('jpgProgressFill');
    const jpgPreview = document.getElementById('jpgPreview');
    const jpgQualitySel = document.getElementById('jpgQuality');
    const jpgScaleSel = document.getElementById('jpgScale');

    convertToJpgBtn.addEventListener('click', async () => {
      const file = pdfToJpgFileInput.files[0];
      if (!file) {
        alert('‡¶è‡¶ï‡¶ü‡¶ø PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
        return;
      }

      convertToJpgBtn.disabled = true;
      jpgStatus.textContent = 'PDF ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
      jpgProgressBar.style.display = 'block';
      jpgProgressFill.style.width = '10%';
      jpgPreview.innerHTML = '';

      try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        const numPages = pdf.numPages;

        jpgStatus.textContent = `${numPages} ‡¶ü‡¶ø ‡¶™‡ßá‡¶ú ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá...`;
        jpgProgressFill.style.width = '20%';

        const quality = parseFloat(jpgQualitySel.value);
        const scale = parseFloat(jpgScaleSel.value);
        const images = [];

        for (let pageNum = 1; pageNum <= numPages; pageNum++) {
          jpgStatus.textContent = `‡¶™‡ßá‡¶ú ${pageNum}/${numPages} ‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`;
          jpgProgressFill.style.width = (20 + (pageNum / numPages) * 70) + '%';

          const page = await pdf.getPage(pageNum);
          const viewport = page.getViewport({ scale: scale });

          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.width = viewport.width;
          canvas.height = viewport.height;

          await page.render({ canvasContext: context, viewport: viewport }).promise;

          const imgDataUrl = canvas.toDataURL('image/jpeg', quality);
          
          const thumbDiv = document.createElement('div');
          thumbDiv.className = 'thumb';
          thumbDiv.style.width = '150px';
          thumbDiv.style.height = '200px';
          thumbDiv.style.cursor = 'default';
          const thumbImg = document.createElement('img');
          thumbImg.src = imgDataUrl;
          thumbDiv.appendChild(thumbImg);
          
          const pageLabel = document.createElement('p');
          pageLabel.textContent = `Page ${pageNum}`;
          pageLabel.style.textAlign = 'center';
          pageLabel.style.margin = '5px 0 0 0';
          pageLabel.style.fontSize = '12px';
          
          const wrapper = document.createElement('div');
          wrapper.appendChild(thumbDiv);
          wrapper.appendChild(pageLabel);
          jpgPreview.appendChild(wrapper);

          images.push({
            dataUrl: imgDataUrl,
            pageNum: pageNum
          });

          await new Promise(r => setTimeout(r, 100));
        }

        jpgStatus.textContent = 'ZIP ‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
        jpgProgressFill.style.width = '95%';

        const zip = new JSZip();
        const baseName = file.name.replace('.pdf', '');

        for (let i = 0; i < images.length; i++) {
          const base64Data = images[i].dataUrl.split(',')[1];
          zip.file(`${baseName}_page_${images[i].pageNum}.jpg`, base64Data, { base64: true });
        }

        const zipBlob = await zip.generateAsync({ type: 'blob' });
        const downloadName = `${baseName}_images.zip`;

        const base64 = await blobToBase64(zipBlob);
        saveToHistory('PDF to JPG', file.name, {
          base64: base64,
          mimeType: 'application/zip',
          downloadName: downloadName
        });

        const url = URL.createObjectURL(zipBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = downloadName;
        a.click();
        URL.revokeObjectURL(url);

        jpgProgressFill.style.width = '100%';
        jpgStatus.textContent = `‚úÖ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ${numPages} ‡¶ü‡¶ø JPG ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`;

      } catch (err) {
        console.error(err);
        alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + err.message);
        jpgStatus.textContent = '‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•';
      } finally {
        convertToJpgBtn.disabled = false;
        setTimeout(() => {
          jpgProgressBar.style.display = 'none';
          jpgProgressFill.style.width = '0';
        }, 5000);
      }
    });

    // ============== PDF Unlock (Premium) ==============
    const unlockPdfFileInput = document.getElementById('unlockPdfFile');
    const pdfPasswordInput = document.getElementById('pdfPassword');
    const unlockBtn = document.getElementById('unlockBtn');
    const checkBtn = document.getElementById('checkBtn');
    const unlockInfo = document.getElementById('unlockInfo');
    const unlockFileName = document.getElementById('unlockFileName');
    const unlockStatus = document.getElementById('unlockStatus');
    const unlockMessage = document.getElementById('unlockMessage');

    checkBtn.addEventListener('click', async () => {
      const file = unlockPdfFileInput.files[0];
      if (!file) {
        alert('‡¶è‡¶ï‡¶ü‡¶ø PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
        return;
      }

      unlockMessage.textContent = 'PDF ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
      unlockInfo.style.display = 'none';

      try {
        const arrayBuffer = await file.arrayBuffer();
        
        try {
          const pdfDoc = await PDFDocument.load(arrayBuffer, { ignoreEncryption: false });
          
          unlockFileName.textContent = file.name;
          unlockStatus.textContent = '‚úÖ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ';
          unlockInfo.style.display = 'block';
          unlockInfo.className = 'success-box';
          unlockMessage.textContent = '‡¶è‡¶á PDF ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ‡•§';
        } catch (e) {
          if (e.message && e.message.includes('encrypted')) {
            unlockFileName.textContent = file.name;
            unlockStatus.textContent = 'üîí ‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ';
            unlockInfo.style.display = 'block';
            unlockInfo.className = 'warning-box';
            unlockMessage.textContent = '‡¶è‡¶á PDF ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§';
          } else {
            throw e;
          }
        }
      } catch (err) {
        console.error(err);
        unlockMessage.textContent = '‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: PDF ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§';
      }
    });

    unlockBtn.addEventListener('click', async () => {
      const file = unlockPdfFileInput.files[0];
      if (!file) {
        alert('‡¶è‡¶ï‡¶ü‡¶ø PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
        return;
      }

      const password = pdfPasswordInput.value.trim();

      unlockBtn.disabled = true;
      unlockMessage.textContent = 'PDF ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
      unlockInfo.style.display = 'none';

      try {
        const arrayBuffer = await file.arrayBuffer();
        
        const loadOptions = password ? { password: password } : {};
        const pdfDoc = await PDFDocument.load(arrayBuffer, loadOptions);
        
        const pdfBytes = await pdfDoc.save();
        
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const downloadName = file.name.replace('.pdf', '_unlocked.pdf');

        const base64 = await blobToBase64(blob);
        saveToHistory('PDF Unlock', file.name, {
          base64: base64,
          mimeType: 'application/pdf',
          downloadName: downloadName
        });

        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = downloadName;
        a.click();
        URL.revokeObjectURL(url);
        
        unlockFileName.textContent = file.name;
        unlockStatus.textContent = '‚úÖ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
        unlockInfo.style.display = 'block';
        unlockInfo.className = 'success-box';
        unlockMessage.textContent = 'üéâ ‡¶∏‡¶´‡¶≤! ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ PDF ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
        
      } catch (err) {
        console.error(err);
        
        if (err.message && (err.message.includes('password') || err.message.includes('encrypted'))) {
          unlockMessage.textContent = '‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!';
        } else {
          unlockMessage.textContent = '‚ùå ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + err.message;
        }
        
        unlockFileName.textContent = file.name;
        unlockStatus.textContent = '‚ùå ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•';
        unlockInfo.style.display = 'block';
        unlockInfo.className = 'warning-box';
      } finally {
        unlockBtn.disabled = false;
      }
    });

    // ============== PDF Compare (Premium) ==============
    const comparePdf1Input = document.getElementById('comparePdf1');
    const comparePdf2Input = document.getElementById('comparePdf2');
    const comparePageInput = document.getElementById('comparePage');
    const compareBtn = document.getElementById('compareBtn');
    const compareStatus = document.getElementById('compareStatus');
    const compareProgressBar = document.getElementById('compareProgressBar');
    const compareProgressFill = document.getElementById('compareProgressFill');
    const compareContainer = document.getElementById('compareContainer');
    const canvas1 = document.getElementById('canvas1');
    const canvas2 = document.getElementById('canvas2');
    const diffResult = document.getElementById('diffResult');

    compareBtn.addEventListener('click', async () => {
      const file1 = comparePdf1Input.files[0];
      const file2 = comparePdf2Input.files[0];
      const pageNum = parseInt(comparePageInput.value);

      if (!file1 || !file2) {
        alert('‡¶¶‡ßÅ‡¶ü‡¶ø PDF ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
        return;
      }

      if (pageNum < 1) {
        alert('‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡ßá‡¶ú ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®');
        return;
      }

      compareBtn.disabled = true;
      compareStatus.textContent = 'PDF ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
      compareProgressBar.style.display = 'block';
      compareProgressFill.style.width = '10%';
      compareContainer.style.display = 'none';
      diffResult.style.display = 'none';

      try {
        const arrayBuffer1 = await file1.arrayBuffer();
        const pdf1 = await pdfjsLib.getDocument({ data: arrayBuffer1 }).promise;
        
        compareStatus.textContent = '‡¶™‡ßç‡¶∞‡¶•‡¶Æ PDF ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá...';
        compareProgressFill.style.width = '30%';

        const arrayBuffer2 = await file2.arrayBuffer();
        const pdf2 = await pdfjsLib.getDocument({ data: arrayBuffer2 }).promise;

        compareStatus.textContent = '‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º PDF ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá...';
        compareProgressFill.style.width = '50%';

        if (pageNum > pdf1.numPages || pageNum > pdf2.numPages) {
          throw new Error('‡¶™‡ßá‡¶ú ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá');
        }

        const page1 = await pdf1.getPage(pageNum);
        const viewport1 = page1.getViewport({ scale: 1.5 });
        
        const ctx1 = canvas1.getContext('2d');
        canvas1.width = viewport1.width;
        canvas1.height = viewport1.height;

        await page1.render({ canvasContext: ctx1, viewport: viewport1 }).promise;

        compareStatus.textContent = '‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡ßá‡¶ú ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá...';
        compareProgressFill.style.width = '70%';

        const page2 = await pdf2.getPage(pageNum);
        const viewport2 = page2.getViewport({ scale: 1.5 });
        
        const ctx2 = canvas2.getContext('2d');
        canvas2.width = viewport2.width;
        canvas2.height = viewport2.height;

        await page2.render({ canvasContext: ctx2, viewport: viewport2 }).promise;

        compareStatus.textContent = '‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º ‡¶™‡ßá‡¶ú ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá...';
        compareProgressFill.style.width = '90%';

        const imageData1 = ctx1.getImageData(0, 0, canvas1.width, canvas1.height);
        const imageData2 = ctx2.getImageData(0, 0, canvas2.width, canvas2.height);

        let differentPixels = 0;
        const totalPixels = Math.min(imageData1.data.length, imageData2.data.length) / 4;

        for (let i = 0; i < Math.min(imageData1.data.length, imageData2.data.length); i += 4) {
          const r1 = imageData1.data[i];
          const g1 = imageData1.data[i + 1];
          const b1 = imageData1.data[i + 2];
          
          const r2 = imageData2.data[i];
          const g2 = imageData2.data[i + 1];
          const b2 = imageData2.data[i + 2];

          const diff = Math.abs(r1 - r2) + Math.abs(g1 - g2) + Math.abs(b1 - b2);
          
          if (diff > 30) {
            differentPixels++;
          }
        }

        const similarity = ((totalPixels - differentPixels) / totalPixels * 100).toFixed(2);

        compareContainer.style.display = 'grid';
        diffResult.style.display = 'block';
        diffResult.innerHTML = `
          <strong>üìä ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤:</strong><br>
          ‡¶∏‡¶æ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø: <strong>${similarity}%</strong><br>
          ‡¶™‡¶æ‡¶∞‡ßç‡¶•‡¶ï‡ßç‡¶Ø: <strong>${(100 - similarity).toFixed(2)}%</strong><br>
          ${similarity > 95 ? '‚úÖ ‡¶™‡ßá‡¶ú‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º ‡¶è‡¶ï‡¶á ‡¶∞‡¶ï‡¶Æ' : similarity > 70 ? '‚ö†Ô∏è ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶™‡¶æ‡¶∞‡ßç‡¶•‡¶ï‡ßç‡¶Ø ‡¶Ü‡¶õ‡ßá' : '‚ùå ‡¶™‡ßá‡¶ú‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ö‡¶®‡ßá‡¶ï ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ'}
        `;

        const comparisonData = {
          pdf1Name: file1.name,
          pdf2Name: file2.name,
          pageNum: pageNum,
          similarity: similarity
        };

        saveToHistory('PDF Compare', `${file1.name} vs ${file2.name}`, {
          base64: btoa(JSON.stringify(comparisonData)),
          mimeType: 'application/json',
          downloadName: 'comparison_report.json'
        });

        compareProgressFill.style.width = '100%';
        compareStatus.textContent = '‚úÖ ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!';

      } catch (err) {
        console.error(err);
        alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + err.message);
        compareStatus.textContent = '‡¶§‡ßÅ‡¶≤‡¶®‡¶æ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•';
      } finally {
        compareBtn.disabled = false;
        setTimeout(() => {
          compareProgressBar.style.display = 'none';
          compareProgressFill.style.width = '0';
        }, 3000);
      }
    });

    // ============== Initialize ==============
    window.addEventListener('load', () => {
      initFloatingText();
      initAuth();
    });
  </script>
</body>
</html>
